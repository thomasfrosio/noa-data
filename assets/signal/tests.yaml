convolve:
  inputs:
    2D:
      shape: [ 1,1,250,251 ]
      path: &convolve_input2D tmp_conv_2D.mrc
    3D:
      shape: [ 1,150,151,152 ]
      path: &convolve_input3D tmp_conv_3D.mrc
  filters:
    0:
      shape: [ 31 ]
      sigma: 5
      path: &filter1D tmp_conv_filter1D.mrc
    1:
      shape: [ 9, 17 ]
      sigma: 3
      path: &filter2D tmp_conv_filter2D.mrc
    2:
      shape: [ 3,3,3 ]
      sigma: 2
      path: &filter3D_0 tmp_conv_filter3D_0.mrc
    3:
      shape: [ 5,5,5 ]
      sigma: 1
      path: &filter3D_1 tmp_conv_filter3D_1.mrc
    4:
      shape: [ 5,3,3 ]
      sigma: 1
      path: &filter3D_2 tmp_conv_filter3D_2.mrc
  tests:
    0:
      input: *convolve_input2D
      filter: *filter1D
      expected: tmp_conv_0.mrc
    1:
      input: *convolve_input3D
      filter: *filter1D
      expected: tmp_conv_1.mrc
    2:
      input: *convolve_input2D
      filter: *filter2D
      expected: tmp_conv_2.mrc
    3:
      input: *convolve_input3D
      filter: *filter2D
      expected: tmp_conv_3.mrc
    4:
      input: *convolve_input3D
      filter: *filter3D_0
      expected: tmp_conv_4.mrc
    5:
      input: *convolve_input3D
      filter: *filter3D_1
      expected: tmp_conv_5.mrc
    6:
      input: *convolve_input3D
      filter: *filter3D_2
      expected: tmp_conv_6.mrc

convolve_separable:
  filter:
    size: 21
    sigma: 4
    path: &filter tmp_conv_separable_filter.mrc
  tests:
    0:
      input: *convolve_input2D
      filter: *filter
      dim: [ 0, 1 ]
      expected: tmp_conv_separable_0.mrc
    1:
      input: *convolve_input2D
      filter: *filter
      dim: [ 0 ]
      expected: tmp_conv_separable_1.mrc
    2:
      input: *convolve_input2D
      filter: *filter
      dim: [ 1 ]
      expected: tmp_conv_separable_2.mrc
    3:
      input: *convolve_input3D
      filter: *filter
      dim: [ 0,1,2 ]
      expected: tmp_conv_separable_3.mrc
    4:
      input: *convolve_input3D
      filter: *filter
      dim: [ 0,1 ]
      expected: tmp_conv_separable_4.mrc
    5:
      input: *convolve_input3D
      filter: *filter
      dim: [ 1,2 ]
      expected: tmp_conv_separable_5.mrc
    6:
      input: *convolve_input3D
      filter: *filter
      dim: [ 0,2 ]
      expected: tmp_conv_separable_6.mrc
    7:
      input: *convolve_input3D
      filter: *filter
      dim: [ 0 ]
      expected: tmp_conv_separable_7.mrc
    8:
      input: *convolve_input3D
      filter: *filter
      dim: [ 1 ]
      expected: tmp_conv_separable_8.mrc
    9:
      input: *convolve_input3D
      filter: *filter
      dim: [ 2 ]
      expected: tmp_conv_separable_9.mrc

median:
  inputs:
    2D:
      shape: [ 1,1,250,250 ]
      path: &medfilt_input2D tmp_medfilt_2D.mrc
    3D:
      shape: [ 1,150,150,150 ]
      path: &medfilt_input3D tmp_medfilt_3D.mrc
  tests:
    0:
      input: *medfilt_input2D
      window: 3
      dim: 1
      border: BORDER_REFLECT
      expected: tmp_medfilt_00.mrc
    1:
      input: *medfilt_input2D
      window: 5
      dim: 1
      border: BORDER_ZERO
      expected: tmp_medfilt_01.mrc
    2:
      input: *medfilt_input3D
      window: 7
      dim: 1
      border: BORDER_REFLECT
      expected: tmp_medfilt_02.mrc
    3:
      input: *medfilt_input3D
      window: 9
      dim: 1
      border: BORDER_ZERO
      expected: tmp_medfilt_03.mrc
    4:
      input: *medfilt_input2D
      window: 11
      dim: 2
      border: BORDER_REFLECT
      expected: tmp_medfilt_04.mrc
    5:
      input: *medfilt_input2D
      window: 9
      dim: 2
      border: BORDER_ZERO
      expected: tmp_medfilt_05.mrc
    6:
      input: *medfilt_input3D
      window: 7
      dim: 2
      border: BORDER_REFLECT
      expected: tmp_medfilt_06.mrc
    7:
      input: *medfilt_input3D
      window: 3
      dim: 2
      border: BORDER_ZERO
      expected: tmp_medfilt_07.mrc
    8:
      input: *medfilt_input3D
      window: 5
      dim: 3
      border: BORDER_REFLECT
      expected: tmp_medfilt_08.mrc
    9:
      input: *medfilt_input3D
      window: 3
      dim: 3
      border: BORDER_ZERO
      expected: tmp_medfilt_09.mrc

lowpass: # assets are not batched
  0:
    shape: [ 3,1,256,256 ]
    cutoff: 0
    width: 0
    path: lowpass_00.mrc
  1:
    shape: [ 3,1,256,256 ]
    cutoff: 0.5
    width: 0
    path: lowpass_01.mrc
  2:
    shape: [ 3,1,256,256 ]
    cutoff: 0.35
    width: 0.1
    path: lowpass_02.mrc
  3:
    shape: [ 3,1,256,512 ]
    cutoff: 0.2
    width: 0.3
    path: lowpass_03.mrc
  4:
    shape: [ 3,128,128,128 ]
    cutoff: 0
    width: 0
    path: lowpass_04.mrc
  5:
    shape: [ 3,128,128,128 ]
    cutoff: 0.5
    width: 0
    path: lowpass_05.mrc
  6:
    shape: [ 3,128,128,64 ]
    cutoff: 0.2
    width: 0.3
    path: lowpass_06.mrc

highpass: # assets are not batched
  0:
    shape: [ 3,1,256,256 ]
    cutoff: 0
    width: 0
    path: highpass_00.mrc
  1:
    shape: [ 3,1,256,256 ]
    cutoff: 0.5
    width: 0
    path: highpass_01.mrc
  2:
    shape: [ 3,1,256,256 ]
    cutoff: 0.35
    width: 0.1
    path: highpass_02.mrc
  3:
    shape: [ 3,1,256,512 ]
    cutoff: 0.2
    width: 0.3
    path: highpass_03.mrc
  4:
    shape: [ 3,128,128,128 ]
    cutoff: 0
    width: 0
    path: highpass_04.mrc
  5:
    shape: [ 3,128,128,128 ]
    cutoff: 0.5
    width: 0
    path: highpass_05.mrc
  6:
    shape: [ 3,128,128,64 ]
    cutoff: 0.2
    width: 0.3
    path: highpass_06.mrc

bandpass: # assets are not batched
  0:
    shape: [ 3,1,256,256 ]
    cutoff: [ 0.4,0.5 ]
    width: [ 0,0 ]
    path: bandpass_00.mrc
  1:
    shape: [ 3,1,512,256 ]
    cutoff: [ 0.3,0.45 ]
    width: [ 0.3,0.05 ]
    path: bandpass_01.mrc
  2:
    shape: [ 3,1,128,128 ]
    cutoff: [ 0.3,0.4 ]
    width: [ 0.05,0.05 ]
    path: bandpass_02.mrc
  3:
    shape: [ 3,128,128,128 ]
    cutoff: [ 0.2,0.45 ]
    width: [ 0.1,0.05 ]
    path: bandpass_03.mrc
  4:
    shape: [ 3,128,128,64 ]
    cutoff: [ 0.1,0.3 ]
    width: [ 0,0.1 ]
    path: bandpass_04.mrc

shift: # save rfft
  2d:
    0:
      shape: [ 1,1,64,71 ]
      shift: [ -32,25 ]
      input: tmp_shift2d_input.mrc
      output: tmp_shift2d_00.mrc
    1:
      shape: [ 1,1,125,126 ]
      shift: [ 12.75,-32.51 ]
      input: ""
      output: tmp_shift2d_01.mrc
    2:
      shape: [ 1,1,64,128 ]
      shift: [ 32,64 ]
      input: ""
      output: tmp_shift2d_02.mrc

  3d:
    0:
      shape: [ 1,64,71,68 ]
      shift: [ -11.1,2.3,5.4 ]
      input: tmp_shift3d_input.mrc
      output: tmp_shift3d_00.mrc
    1:
      shape: [ 1,64,72,65 ]
      shift: [ 6.5,3.4,-3 ]
      input: ""
      output: tmp_shift3d_01.mrc
    2:
      shape: [ 1,64,64,131 ]
      shift: [ 32,32,65.5 ]
      input: ""
      output: tmp_shift3d_02.mrc
    3:
      shape: [ 1,160,160,160 ]
      shift: [ 0,11.5,-20 ]
      input: ""
      output: tmp_shift3d_03.mrc

ctf_isotropic:
  0:
    output: ctf_iso_00.mrc
    shape: [ 1,1,128,128 ]
    pixel_size: 1
    defocus: 0.5
    voltage: 300
    amplitude: 0.02
    cs: 2.7
    phase_shift: 0
    bfactor: -30
  1:
    output: ctf_iso_01.mrc
    shape: [ 1,1,512,512 ]
    pixel_size: 1.5
    defocus: 2.5
    voltage: 200
    amplitude: 0.05
    cs: 2.7
    phase_shift: 0.25
    bfactor: -20
  2:
    output: ctf_iso_02.mrc
    shape: [ 1,1,2048,2048 ]
    pixel_size: 1
    defocus: 2.5
    voltage: 300
    amplitude: 0.02
    cs: 2.7
    phase_shift: 0.3
    bfactor: -30

ctf_anisotropic:
  0:
    output: ctf_aniso_00.mrc
    shape: [ 1,1,128,128 ]
    pixel_size: [1, 1]
    defocus: [0.5, 0, 0]
    voltage: 300
    amplitude: 0.02
    cs: 2.7
    phase_shift: 0
    bfactor: -30
  1:
    output: ctf_aniso_01.mrc
    shape: [ 1,1,512,512 ]
    pixel_size: [1.5, 1]
    defocus: [2.5, 0.5, 0]
    voltage: 200
    amplitude: 0.05
    cs: 2.7
    phase_shift: 0.25
    bfactor: -20
  2:
    output: ctf_aniso_02.mrc
    shape: [ 1,1,512,512 ]
    pixel_size: [1, 1]
    defocus: [2.5, 0.3, 45] # in degrees
    voltage: 300
    amplitude: 0.02
    cs: 2.7
    phase_shift: 0.3
    bfactor: -30
